<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
    <title>Untitled Shooter 2: Electric Boogaloo</title>
	<script type="text/javascript" src="phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

		game.load.image('ship', 'assets/ship.png');
		game.load.image('space-baddie', 'assets/space-baddie.png');
		game.load.image('bullet', 'assets/bullet82.png');
		game.load.image('pixel-space', 'assets/pixel_space.png');

		game.load.spritesheet('kaboom', 'assets/explode.png', 128, 128);

}

var ship;
var aliens;

var bullets;

var fireRate = 100;
var nextFire = 0;

var lives = 3;

var score = 0;
var scoreText;

function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    //  A simple background for our game
    game.add.sprite(0, 0, 'pixel-space');

		// Bullets we've added for the shooting of space aliens
		bullets = game.add.group();
		bullets.enableBody = true;
		bullets.physicsBodyType = Phaser.Physics.ARCADE;

		bullets.createMultiple(7, 'bullet');
		bullets.setAll('checkWorldBounds', true);
		bullets.setAll('outOfBoundsKill', true);

		// Ship we've added for the shooting of the bullets
		ship = game.add.sprite(400, 300, 'ship');
		ship.scale.setTo(1.3, 1.3);
	 	ship.anchor.set(0.5);

		game.physics.enable(ship, Phaser.Physics.ARCADE);
		ship.body.allowRotation = false;

		aliens = game.add.physicsGroup(Phaser.Physics.ARCADE);

		var difficulty = 15;

		for (var i = 0; i < difficulty; i++)
		{
				var s = aliens.create(game.rnd.integerInRange(0, 800), game.rnd.integerInRange(0, 25), 'space-baddie');
				s.body.velocity.set(game.rnd.integerInRange(-200, 200), game.rnd.integerInRange(-200, 200));
		}

		for (var i = 0; i < difficulty; i++)
		{
				var s = aliens.create(game.rnd.integerInRange(0, 800), game.rnd.integerInRange(775, 800), 'space-baddie');
				s.body.velocity.set(game.rnd.integerInRange(-200, 200), game.rnd.integerInRange(-200, 200));
		}

		aliens.setAll('body.collideWorldBounds', true);
		aliens.setAll('body.bounce.x', 1);
		aliens.setAll('body.bounce.y', 1);

		//  The score
		scoreText = game.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#fff' });

		livesCount = game.add.text(game.world.width - 120, 10, `Health: ${lives}`, { fontSize: '32px', fill: '#fff' });

}

function update() {
		// SHOOTING AND LOOTING

		ship.rotation = game.physics.arcade.angleToPointer(ship);

		if (game.input.activePointer.isDown) {
				fire();
		}

		game.physics.arcade.overlap(bullets, aliens, shootAlien, null, this);

		// DEATH - WILL WANT TO COMMENT THIS OUT!!!!
		game.physics.arcade.overlap(ship, aliens, loseLife, null, this);

		// SHOOTING AND LOOTING


}

function fire() {

    if (game.time.now > nextFire && bullets.countDead() > 0)
    {
        nextFire = game.time.now + fireRate;

        var bullet = bullets.getFirstDead();

        bullet.reset(ship.x - 8, ship.y - 8);

        game.physics.arcade.moveToPointer(bullet, 300);
    }

}

function shootAlien (bullet, alien) {

    // Removes the star from the screen
		bullet.kill();
    alien.kill();

    //  Add and update the score
    score += 100;
    scoreText.text = 'Score: ' + score;

}

function loseLife (ship, alien) {
	  lives--;
		alien.kill();
		livesCount.text = `Health: ${lives}`


    //  EXPLOSIONS!
    // var explosion = explosions.getFirstExists(false);
    // explosion.reset(player.body.x, player.body.y);
    // explosion.play('kaboom', 30, false, true);

		// game over text
		if (lives < 1){
			ship.kill();
			game.add.text(320, 300, 'Game Over', { fontSize: '32px', fill: '#fff' })
		}
}

function repopulateAliens(){

}

</script>

</body>
</html>
